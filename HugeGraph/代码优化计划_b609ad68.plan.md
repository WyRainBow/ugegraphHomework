---
name: 代码优化计划
overview: 根据检查报告，制定简化的代码优化计划，确保功能可用，不进行过度优化。重点修复关键问题，完善错误处理，确保所有功能正常运行。
todos: []
---

# 代码优化计划

## 一、优化目标

确保功能可用，修复关键问题，不进行过度优化。重点：
- 确保代码能正常运行
- 修复明显的bug和错误处理
- 完善关键功能的降级机制
- 确保所有输出文件正确生成

## 二、优化任务

### 2.1 完善投票分析的 LLM 辅助解析

**问题**：代码中有 `self.llm` 但未在 `_extract_vote_from_body` 中使用

**优化**：
- 在正则表达式提取失败时，使用 LLM 辅助解析
- 添加降级机制：正则优先，LLM 作为备选
- 文件：`src/tasks/vote_analyzer.py`

### 2.2 完善错误处理机制

**问题**：错误处理和降级机制不完整

**优化**：
- 在工作流中添加 try-catch 错误处理
- 确保单个步骤失败不影响整体流程
- 添加清晰的错误提示
- 文件：`src/workflows/graduation_workflow.py`

### 2.3 验证功能完整性

**问题**：需要确保所有功能都能正常运行

**优化**：
- 检查所有脚本是否能正常执行
- 验证输出文件是否正确生成
- 确保占位符替换逻辑正确
- 文件：`scripts/*.py`

### 2.4 修复潜在的代码问题

**问题**：检查报告中提到的潜在问题

**优化**：
- 确保 LLM 客户端的新参数能正确传递
- 验证 Prompt 更新后的格式正确性
- 检查文件路径和依赖关系

## 三、实施步骤

1. **完善投票分析器**：添加 LLM 辅助解析的降级机制
2. **完善工作流错误处理**：添加异常捕获和错误提示
3. **验证脚本功能**：确保所有脚本能正常运行
4. **测试完整流程**：验证从输入到输出的完整流程

## 四、预期结果

- ✅ 投票分析在正则失败时能使用 LLM 辅助解析
- ✅ 工作流有完善的错误处理，不会因单个步骤失败而崩溃
- ✅ 所有脚本能正常执行，生成正确的输出文件
- ✅ 功能完整可用，满足需求