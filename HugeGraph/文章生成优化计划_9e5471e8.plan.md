---
name: 文章生成优化计划
overview: 优化引用金句提取、投票统计展示格式和链接集合生成三个关键问题，提升文章质量和专业性
todos: []
---

# 文章生成优化计划

## 问题分析

### 1. 引用金句提取问题
- **现状**：从摘要中提取，但摘要不包含原始邮件正文，导致无法找到实际引用
- **问题**：Prompt 过于严格，只查找特定关键词（"Good luck", "Congrats"等），缺乏语义理解
- **影响**：返回错误信息而非实际引用，影响文章质量

### 2. 投票统计摘要格式问题
- **现状**：简单表格展示，视觉效果"怪怪的"
- **问题**：缺乏层次感和重点突出，不够专业
- **影响**：统计数据展示不够吸引人

### 3. 链接集合占位符问题
- **现状**：只有占位符 `[链接集合占位符]`，没有实际内容
- **问题**：缺少实际链接生成逻辑
- **影响**：文章不完整，缺少重要资源链接

## 优化方案

### 优化1：改进引用金句提取

#### 1.1 修改数据源
- **文件**：`src/tasks/article_generator.py`
- **改动**：`extract_quotes` 方法改为从原始投票数据（`outputs/data/vote_data.json`）中提取，而不是从摘要中提取
- **实现**：
  - 读取 `outputs/data/vote_data.json` 中的原始投票数据
  - 提取每个投票的 `raw_text` 字段（包含完整邮件正文）
  - 将原始邮件正文传递给 LLM 进行引用提取

#### 1.2 优化引用提取 Prompt
- **文件**：`config/prompts/quote_extraction.md`
- **改动**：改进 Prompt，使用语义理解而非关键词匹配
- **新 Prompt 结构**：
  ```
  从投票邮件正文中提取正面评价、祝贺语或支持性陈述。
  
  提取规则：
  1. 优先选择 IPMC 成员（binding votes）的邮件
  2. 查找以下类型的表达：
     - 明确的祝贺（"Congratulations", "Congrats", "Well done"等）
     - 正面评价（"Great work", "Excellent", "Impressive"等）
     - 支持性陈述（"I support", "I'm happy to see", "This is great news"等）
     - 对项目的积极评价（"Strong community", "Mature project"等）
  3. 如果邮件正文较长，提取最相关的1-2句话
  4. 保持原文，不要改写或总结
  5. 如果没有找到明确的正面评价，可以提取投票者表达支持的关键句子
  
  输出格式：
  每条引用使用 Markdown blockquote：
  > 引用内容 — 姓名
  ```

#### 1.3 改进提取逻辑
- **文件**：`src/tasks/article_generator.py`
- **改动**：
  - 修改 `extract_quotes` 方法，接受原始投票数据列表
  - 优先处理 binding votes 的邮件正文
  - 如果 LLM 返回空结果，降级处理：提取投票者姓名和简短支持性文本
  - 确保至少返回 2-3 条引用（即使质量稍低）

### 优化2：改进投票统计摘要格式

#### 2.1 创建统计摘要格式化器
- **文件**：`src/tasks/vote_statistics_formatter.py`（新建）
- **功能**：将统计数据格式化为更专业的 Markdown 格式
- **实现**：
  - 使用卡片式布局展示关键指标
  - 突出显示通过率和绑定投票数
  - 添加视觉分隔和层次结构
  - 采用清晰的统计展示方式

#### 2.2 新格式设计
```markdown
### 投票结果概览

**总投票数**：26票 | **通过率**：100% ✅

#### 关键指标

| 指标 | 数值 | 说明 |
|------|------|------|
| **IPMC 绑定投票** | 18票 (69.2%) | 具有决定权的投票 |
| **社区支持投票** | 8票 (30.8%) | 社区成员意见 |
| **反对票** | 0票 | 无反对意见 |
| **弃权票** | 0票 | 无弃权 |

#### 投票分布

- ✅ **+1 支持票**：26票（100%）
- ⚪ **+0 弃权票**：0票（0%）
- ❌ **-1 反对票**：0票（0%）

**结论**：项目获得社区一致支持，18位 IPMC 成员投出绑定支持票，充分体现了项目的成熟度和社区认可。
```

#### 2.3 集成到工作流
- **文件**：`src/workflows/graduation_workflow.py`
- **改动**：在生成文章前，先格式化投票统计摘要
- **实现**：在 `ArticleGenerator.generate_article_content` 调用前，格式化 `vote_summary`

### 优化3：生成链接集合

#### 3.1 创建链接生成器
- **文件**：`src/tasks/link_collector.py`（新建）
- **功能**：收集和生成项目相关链接
- **链接类型**：
  - 项目主页：Apache HugeGraph 官网
  - GitHub 仓库：Apache HugeGraph GitHub
  - 文档链接：项目文档
  - 投票线程：Apache 邮件列表投票线程
  - 董事会提案：Apache 董事会会议议程
  - 相关项目：Apache SeaTunnel、Apache TinkerPop 等

#### 3.2 链接数据源
- **文件**：`config/links.json`（新建）
- **内容**：预定义的项目相关链接
```json
{
  "project_links": [
    {
      "title": "Apache HugeGraph 官网",
      "url": "https://hugegraph.apache.org/",
      "description": "项目官方网站"
    },
    {
      "title": "GitHub 仓库",
      "url": "https://github.com/apache/hugegraph",
      "description": "源代码仓库"
    }
  ],
  "related_projects": [
    {
      "title": "Apache SeaTunnel",
      "url": "https://seatunnel.apache.org/",
      "description": "数据集成平台"
    }
  ]
}
```

#### 3.3 链接集合格式化
- **文件**：`src/tasks/link_collector.py`
- **功能**：生成格式化的链接集合 Markdown
- **输出格式**：
```markdown
## 相关资源

### 项目链接
- [Apache HugeGraph 官网](https://hugegraph.apache.org/) - 项目官方网站
- [GitHub 仓库](https://github.com/apache/hugegraph) - 源代码和文档
- [项目文档](https://hugegraph.apache.org/docs/) - 使用指南和 API 文档

### 投票与提案
- [毕业投票线程](https://lists.apache.org/thread/djkxttgpj08v74r8rqdv3np856g3krlr) - Apache 邮件列表投票讨论
- [董事会提案](https://agenda.apache.org/meetings/2026-01-21?#establish-the-apache-hugegraph-project) - 设立项目的特别提案

### 相关项目
- [Apache SeaTunnel](https://seatunnel.apache.org/) - 数据集成平台
- [Apache TinkerPop](https://tinkerpop.apache.org/) - 图计算框架
```

#### 3.4 集成到工作流
- **文件**：`src/workflows/graduation_workflow.py`
- **改动**：在 `_replace_placeholders` 方法中，替换 `[链接集合占位符]` 为实际链接集合
- **实现**：
  - 调用 `LinkCollector.generate_link_collection()` 生成链接
  - 替换占位符

### 优化4：改进工作流集成

#### 4.1 修改 ArticleGenerator
- **文件**：`src/tasks/article_generator.py`
- **改动**：
  - `extract_quotes` 方法接受原始投票数据
  - 从 `outputs/data/vote_data.json` 读取原始数据
  - 改进错误处理，确保至少返回一些引用

#### 4.2 修改 GraduationWorkflow
- **文件**：`src/workflows/graduation_workflow.py`
- **改动**：
  - 在生成文章前格式化投票统计
  - 在替换占位符时生成链接集合
  - 改进引用提取的数据源

## 实施步骤

1. **步骤1**：创建 `src/tasks/vote_statistics_formatter.py`，实现统计摘要格式化
2. **步骤2**：创建 `src/tasks/link_collector.py` 和 `config/links.json`，实现链接生成
3. **步骤3**：修改 `config/prompts/quote_extraction.md`，优化引用提取 Prompt
4. **步骤4**：修改 `src/tasks/article_generator.py`，改进引用提取逻辑
5. **步骤5**：修改 `src/workflows/graduation_workflow.py`，集成所有优化
6. **步骤6**：测试完整工作流，确保所有功能正常

## 预期效果

1. **引用金句**：从原始邮件中提取真实的正面评价和祝贺语，至少 2-3 条
2. **投票统计**：专业、清晰的统计展示，突出关键指标
3. **链接集合**：完整的项目相关链接，便于读者深入了解项目